services:
  gyman.app.subdomain_provider:
    class: Gyman\Bundle\AppBundle\Services\SubdomainProvider
    arguments:
      - @request_stack
      - %base_url%

  gyman.app.test_subdomain_provider:
      class: Gyman\Bundle\AppBundle\Services\TestSubdomainProvider

  gyman.app.subdomain_name_lister:
    class: Gyman\Bundle\AppBundle\Listener\SubdomainNameListener
    arguments:
      - @=service(parameter('subdomain_provider_service'))
      - @service_container
    tags:
      - {name: kernel.event_listener, event: kernel.request, method: onKernelRequest }

  gyman.default.request.arraycollection_converter:
    class: Gyman\Bundle\AppBundle\Request\ArrayCollectionConverter
    calls:
      - [setEntityManager, [@doctrine.orm.club_entity_manager]]
    tags:
      - { name: request.param_converter}

  gyman.app.club_settings_type:
    class: Gyman\Bundle\AppBundle\Form\SettingsType
    tags:
      - { name: form.type, alias: club_settings }

  gyman.app.club_details_type:
    class: Gyman\Bundle\AppBundle\Form\ClubDetailsType
    tags:
      - { name: form.type, alias: club_details }

  gyman.app.handler.settings_update:
    class: Gyman\Bundle\AppBundle\Services\SettingsUpdateHandler
    arguments:
      - @gyman.repository.section
      - @gyman.club.repository
      - @=service('gyman.club.provider').getCurrentClub()

  gyman.app.twig.entries_extension:
    class: Gyman\Bundle\AppBundle\Twig\EntriesExtension
#    arguments:
#      - @gyman.entries.repository
    calls:
      - [setEntryRepository, [@gyman.entries.repository]]
    tags:
      - { name: twig.extension }


  gyman.twig.voucher_extension:
      class: Gyman\Bundle\AppBundle\Twig\VoucherExtension
      calls:
        - [setTranslator, [@translator]]
      tags:
        - { name: twig.extension }