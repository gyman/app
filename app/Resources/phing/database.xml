<project name="gyman.database" default="reset-db">
    <target name="reset-db">

        <!--Prevents accidental resetting of prod db-->

        <if>
            <equals arg1="${env}" arg2="prod" />
            <then>
                <fail message="Cannot reset-db on prod environment!!!" />
            </then>
        </if>

        <!--User have to always set club property unless it's test environment-->

        <if>
            <and>
                <not>
                    <equals arg1="${env}" arg2="test" />
                </not>
                <not>
                    <isset property="club" />
                </not>
            </and>
            <then>
                <fail message="No club (-Dclub) property set" />
            </then>
        </if>

        <!--If we're performing testing - it is done on test club db-->

        <if>
            <and>
                <equals arg1="${env}" arg2="test" />
            </and>
            <then>
                <property name="club" value="test" />
            </then>
        </if>

        <!--If no env is provided, we assume it's dev-->

        <if>
            <not>
                <isset property="env" />
            </not>
            <then>
                <echo>Setting to default environment (dev) because you didn't use -Denv parameter</echo>
                <property name="env" value="dev" />
            </then>
        </if>

        <!--<exec command="${php_bin} ${symfony_console} doctrine:database:drop &#45;&#45;connection=default &#45;&#45;env=${env} &#45;&#45;force &#45;&#45;no-interaction &#45;&#45;if-exists" checkreturn="false" passthru="true" />-->
        <!--<exec command="${php_bin} ${symfony_console} doctrine:database:create &#45;&#45;connection=default &#45;&#45;env=${env} &#45;&#45;no-interaction" checkreturn="false" passthru="true" />-->
        <exec command="${php_bin} ${symfony_console} doctrine:schema:drop --em=default --env=${env} --force" checkreturn="true" passthru="true" />
        <exec command="${php_bin} ${symfony_console} doctrine:schema:create --em=default --env=${env} --no-interaction" checkreturn="true" passthru="true" />
        <exec command="${php_bin} ${symfony_console} doctrine:fixtures:load --no-interaction --em=default" checkreturn="true" passthru="true" />

        <!--<exec command="${php_bin} ${symfony_console} doctrine:database:drop -vvv &#45;&#45;club=${club} &#45;&#45;env=${env} &#45;&#45;force &#45;&#45;if-exists &#45;&#45;no-interaction" checkreturn="false" passthru="true" />-->
        <!--<exec command="${php_bin} ${symfony_console} doctrine:database:create &#45;&#45;connection=club &#45;&#45;club=${club} &#45;&#45;env=${env} &#45;&#45;force &#45;&#45;no-interaction" checkreturn="false" passthru="true" />-->
        <exec command="${php_bin} ${symfony_console} doctrine:schema:drop --em=club --club=${club} --env=${env} --force" checkreturn="true" passthru="true" />
        <exec command="${php_bin} ${symfony_console} doctrine:schema:create --em=club --club=${club} --env=${env} --no-interaction" checkreturn="true" passthru="true" />
        <exec command="${php_bin} ${symfony_console} doctrine:fixtures:load --no-interaction --em=club --club=${club}" checkreturn="true" passthru="true" />


        <!--<exec command="${php_bin} ${symfony_console} doctrine:schema:drop &#45;&#45;club=${club} &#45;&#45;env=${env} &#45;&#45;force &#45;&#45;no-interaction" checkreturn="true" passthru="true" />-->
        <!--<exec command="${php_bin} ${symfony_console} doctrine:schema:create &#45;&#45;club=${club} &#45;&#45;env=${env} &#45;&#45;no-interaction" checkreturn="true" passthru="true" />-->
        <!--<exec command="${php_bin} ${symfony_console} doctrine:fixtures:load &#45;&#45;no-interaction &#45;&#45;club=${club}" checkreturn="true" passthru="true" />-->
    </target>
</project>
